"""
Эмулятор командной строки (Вариант 7).
Этап 1: REPL (Read-Eval-Print Loop) - Цикл "Чтение-Выполнение-Печать".
"""

import sys
import os
import shlex

def main():
    """Главная функция, запускающая эмулятор."""
    print("Эмулятор командной строки (Вариант 7). Для выхода введите 'exit'.")

    # Бесконечный цикл, который будет читать команды пользователя
    while True:
        # 2. Приглашение к вводу должно содержать имя VFS.
        # Пока имени VFS у нас нет, используем просто 'vfs>'
        # Позже мы его доработаем.
        prompt = "vfs> "
        try:
            # Читаем строку, введенную пользователем
            user_input = input(prompt).strip()
        except EOFError:  # Если нажали Ctrl+D (Unix) или Ctrl+Z (Windows)
            print()  # Переводим строку
            break  # Выходим из цикла
        except KeyboardInterrupt:  # Если нажали Ctrl+C
            print()  # Переводим строку
            continue  # Просто начинаем цикл заново, не выходя

        # Если пользователь ничего не ввел, просто показываем приглашение снова
        if not user_input:
            continue

        # 3. Парсер, который поддерживает раскрытие переменных окружения.
        # Мы используем shlex.split для корректного разбиения строки с учетом кавычек.
        # Но сначала заменим переменные окружения (например, $HOME) на их значения.
        expanded_input = os.path.expandvars(user_input)  # Это делает замену $HOME на реальный путь
        try:
            parts = shlex.split(expanded_input)
        except ValueError as e:
            # 4. Сообщить об ошибке (в данном случае, ошибка в кавычках)
            print(f"Ошибка разбора команды: {e}")
            continue

        if not parts:
            continue

        # Первое слово - это команда, остальное - аргументы
        command = parts[0]
        args = parts[1:]

        # 6. Команда exit - завершает работу эмулятора
        if command == "exit":
            print("Выход из эмулятора.")
            break

        # 5. Команды-заглушки ls и cd
        if command == "ls":
            # Заглушка: просто выводим свое имя и аргументы
            print(f"Команда: ls, Аргументы: {args}")
            # Здесь в будущем будет логика вывода списка файлов VFS
        elif command == "cd":
            # Заглушка: просто выводим свое имя и аргументы
            print(f"Команда: cd, Аргументы: {args}")
            # Здесь в будущем будет логика смены директории в VFS
        else:
            # 4. Сообщить об ошибке выполнения команд (неизвестная команда)
            print(f"Ошибка: неизвестная команда '{command}'")

if __name__ == "__main__":
    main()
